<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>[리눅스 정리 - 초보자를 위한 가이드] 4장. 파일 시스템</title>
	
	<meta name="author" content="Donghyun Seo">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<link rel="apple-touch-icon" sizes="57x57" href="/assets/ico/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/assets/ico/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/ico/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/assets/ico/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/ico/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/assets/ico/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/ico/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/assets/ico/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/assets/ico/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="/assets/ico/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/assets/ico/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/assets/ico/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/assets/ico/favicon-16x16.png">
	<link rel="manifest" href="/assets/ico/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="/assets/ico/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/egaoneko">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="https://kr.linkedin.com/in/donghyunseo">
				<i class="fa fa-linkedin"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="/assets/media/logo.jpg" style="width: 35px;" class="img-circle" />
				
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/2010/03/01/profile.html">About</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<a href="#" class="btn btn-default">
			<i class="fa fa-arrow-up"></i>
		</a>
	</div>
	<!-- div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/2010/03/01/profile.html"><i class="fa fa-search"></i>About</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div -->

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->

<!--form id="search_form" action="/search.html" method="get" class="text-center" style="margin-bottom: 20px;">
  <input type="text" id="search_box" name="query" placeholder="Search...">
</form-->

<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="/assets/media/logo.jpg" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/"></a>
    </h3>
</header>


<div id="bio" class="text-center">
	How do you define yourself?
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/egaoneko">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/donghyunseo">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		

		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
	<!--ul id="contact-list-secondary" class="list-unstyled list-inline">
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul-->
</div>

<div id="sidebar-menu" class="text-center">
	<h3><a href="/">Home</a></h3>
	<h3><a href="/2010/03/01/profile.html">About</a></h3>
	<h3><a href="/categories.html">Categories</a></h3>
	<h3><a href="/tags.html">Tags</a></h3>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>[리눅스 정리 - 초보자를 위한 가이드] 4장. 파일 시스템 </h1>
</div>

<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   May
	   25th,
	   
	   2015
	 </span>
	  <div class="article_body">
	  <p>이 파일 시스템 부분을 처음 리눅스를 배우는 사람에게 가이드라인을 제안하고자 하는 이 문서에서 어느 정도 설명해야 맞는 것인지 판단이 서지 않았다. 그리고 사실 필자 또한 이 부분에 대하여 잘 알지 못한다. 현재 필자가 참여하고 있는 리눅스를 처음 배우는 사람을 대상으로 하는 스터디에서 이 부분을 언급하였기에 필자 또한 아는 것과 검색을 통해 알아본 것을 작성하였다.</p>

<blockquote>
  <p>파일 시스템(file system, 문화어: 파일체계)은 컴퓨터에서 파일이나 자료를 쉽게 발견 및 접근할 수 있도록 보관 또는 조직하는 체제를 가리키는 말이다.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p>
</blockquote>

<p><img src="/assets/media/linux-starter-guide/파일시스템.jpg" alt="screenshot" /></p>

<p>파일 시스템은 통상 하드 디스크나 CD-ROM 같은 실제 자료 보관 장치를 사용하여 파일의 물리적 소재를 관리하는 것을 가리키나 네트워크 프로토콜(NFS, SMB, 9P 등)을 수행하는 클라이언트를 통하여 파일 서버 상의 자료로의 접근을 제공하는 방식과 가상의 형태로서 접근 수단만이 존재하는 방식(procfs 등)도 파일 시스템의 범위에 포함될 수 있다. 디렉터리 서비스나 레지스트리와는 의미가 조금 다르다.</p>

<p>리눅스는 다양한 파일시스템들을 지원하는데 중요 파일 시스템들은 ext, etx2, minix, xiafs, msdos, hpfs OS/2, isofs CD-ROM, umsdos, nfs, sysv 등이 있다. 이중 이 문서에서 살펴보고자 하는 파일 시스템은 ext, ext2, ext3, ext4로 리눅스 초기에 사용되었거나 많이 사용되는 파일 시스템들이다.</p>

<h2 id="extended-file-system">01 확장 파일 시스템(extended file system)</h2>

<h3 id="ext">ext</h3>
<p>리눅스 초기에 사용되던 파일 시스템이며 호환성이 없다. ext2의 원형이다.</p>

<hr />

<h3 id="ext2">ext2</h3>
<p>ext3가 개발되기 이전까지 가장 많이 사용된 파일 시스템으로 리눅스 파일 시스템 대부분의 기능을 제공하는 파일 시스템이다. 특히 ext2는 뛰어난 안정성과 속도로 가장 유명한 파일 시스템으로 자리 잡았고 ext3 또한 ext2에 기반을 두어 개발되었다. 또한 쉽게 호환되며 업그레이드도 쉽게 설계되어 있다.<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup></p>

<hr />

<h3 id="ext3">ext3</h3>
<p>ext2 파일시스템에 저널링(Journaling)<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup>을 지원하도록 확장된 파일시스템이다. 현재 리눅스에 가장 많이 사용되고 있다.<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup></p>

<hr />

<h3 id="ext4">ext4</h3>
<p>ext3 파일시스템을 확장한 파일시스템으로 Extent라는 기능을 제공하여, 파일에 디스크 할당 시 물리적으로 연속적인 블록을 할당할 수 있도록 하여, 파일 접근 속도 향상 및 단편화<sup id="fnref:5"><a href="#fn:5" class="footnote">5</a></sup>를 줄이도록 설계된 파일시스템이다.<sup id="fnref:4:1"><a href="#fn:4" class="footnote">4</a></sup></p>

<blockquote>
  <ul>
    <li>
      <p>파일의 확장자는 필요 없으며 파일의 특성을 알리기 위해 확장자 사용가능 (*.c, *.java)</p>
    </li>
    <li>
      <p>’.’ 으로 시작하는 파일은 숨겨진 파일 (‘ls -a’ 명령으로 보임)</p>
    </li>
    <li>
      <p>’.’은 현재 디렉토리, ‘..’ 는 부모 디렉토리</p>
    </li>
    <li>
      <p>파일 시스템의 크기는 최대 2Tib ~ 16 TiB (변동 가능)</p>
    </li>
  </ul>
</blockquote>

<h2 id="ext2--extended-file-system">02 ext2 파일시스템 구조(extended file system)</h2>

<p>이 문서에서는 ext3가 개발되기 이전까지 가장 많이 사용된 파일 시스템인 ext2에 대해서 살펴보고자 한다. 이 문서의 내용은 아래 사이트들을 정리한 것이다.</p>

<ul>
  <li><a href="http://guswnsla1223.tistory.com/84">똑똑한여자님의 블로그</a></li>
  <li><a href="http://bestheroz.blog.me/66700589">bestheroz님의 블로그</a></li>
  <li><a href="http://cafe.naver.com/securitycommunity/127">보안 커뮤니티</a></li>
  <li><a href="http://ko.wikipedia.org/wiki/Ext2">위키백과 - Ext2</a></li>
</ul>

<p>ext2 파일시스템은 비교적 속도가 빠르고 안정적인 UFS(Unix FileSystem)을 기반으로 필요한 기능을 추려서, 보다 단순하게 만들어졌다. 따라서 ext2는 분석, 이해하기가 쉽다. 다음은 ext2 파일시스템의 레이아웃이다.</p>

<p><img src="/assets/media/linux-starter-guide/파일시스템1.jpg" alt="screenshot" /></p>

<p>ext2 파일시스템은 부트섹터(Boot Sector)와 여러 개의 블록 그룹(Block Group)으로 구성된다. 블록이란 파일시스템에서 데이터를 저장하는 단위이며, 메모리에서 I/O 작업을 한 번 거칠 때 읽거나 쓰는 단위가 된다. 파일시스템을 생성할 때 1KB~4KB 사이에서 블록의 크기를 지정 가능하다.</p>

<p><img src="/assets/media/linux-starter-guide/파일시스템2.jpg" alt="screenshot" /></p>

<p>각 블록 그룹에는 파일시스템을 구성하는 정보들이 담겨져 있다. 가장 마지막의 블록 그룹을 제외하고는 모든 블록 그룹들이 같은 블록 개수를 가지며, 여기에 파일 이름, meta data, 파일 데이터가 기록된다.</p>

<hr />

<h3 id="block-group">블록 그룹 (Block Group)</h3>

<p><img src="/assets/media/linux-starter-guide/파일시스템3.png" alt="screenshot" /></p>

<p>블록그룹은 블록들의 모임이며, OS커널이 같은 파일에 속하는 데이터 블록은 같은 블록 그룹에 저장하려고 노력하기 때문에 파일의 단편화<sup id="fnref:6"><a href="#fn:6" class="footnote">6</a></sup>를 줄일 수 있다.</p>

<p>파일 시스템의 전체적인 정보는 슈퍼 블록(Super Block)과 그룹 디스크립터 테이블(Group Descriptor Table)에 저장된다. 슈퍼 블록과 그룹 디스크립터 테이블은 0번 블록 그룹의 정보만을 사용하지만 주요 데이터이기 때문에 손상될 경우를 대비하여 모든 블록 그룹에 사본이 저장되어 있다.</p>

<p>블록 그룹의 개수와 크기는 해당 파티션의 블록의 크기에 따라 달라진다. 그룹 내의 각 블록들이 할당되어 있는지 비어있는 지를 알 수 있는 블록 비트맵(Block Bitmap)이 1Block 안에 저장되어야 한다.</p>

<p>설정한 블록의 크기가 4KB일 때 8 bit * 4096 Byte = 32,768 개, 각 bit당 하나씩의 데이터 블록에 해당하므로 Block Bitmap이 표현할 수 있는 블록의 총 개수는 32,768개가 된다. 한 블록이 4KB인 경우, 32KB * 4KB = 128MB, 하나의 블록 그룹은 최대 128MB의 블록을 가질 수 있다. 또한 10GB의 파티션에 Ext2 파일시스템을 생성한다면 10240MB / 128MB = 80개의 블록 그룹이 파티션에 생성된다.</p>

<p>따라서 파티션마다 생성되는 블록 그룹의 게수는 다르며, 블록의 크기가 작을수록 블록 그룹의 개수가 많아지게 된다.</p>

<h4 id="section">주요 저장 내용</h4>
<ul>
  <li>슈퍼 블록 ( Super Block - 1 Block )</li>
  <li>그룹 디스크립터 테이블 ( Group Descriptor Table - n Block )</li>
  <li>블록 비트맵 ( Block Bitmap - 1 Block )</li>
  <li>I-노드 비트맵 ( Inode Bitmap - 1 Block )</li>
  <li>I-노드 테이블 ( Inode Table - n Block )</li>
  <li>파일 데이터 블록 ( FIle Data Blocks - n Block )</li>
</ul>

<hr />

<h3 id="super-block">슈퍼 블록 (Super Block)</h3>

<p>슈퍼 블록은 파일시스템의 블록을 대표하는 블록으로, Ext2 파일시스템에서 사용되는 주요 설정 정보들이 기록되어 있는 영역이다. 블록의 크기에 관계없이 항상 블록그룹의 첫 번째 블록에 위치한다. 슈퍼블록은 반드시 1KB인 경우에 맞춰서 저장된다.<sup id="fnref:7"><a href="#fn:7" class="footnote">7</a></sup> 만약 블록의 크기가 4KB라면 슈퍼블록은 한 블록을 모두 차지하며, 1KB만 사용하고 나머지 3KB는 사용하지 않고 비워둔다.</p>

<p>각 Group마다 Super Block의 내용은 동일하며 만약 다르면 파일 시스템 손상된 것이다. 파일 시스템이 Mount될 때, 커널은 Group 0 에 들어있는 Super Block을 읽는다. 주요 Data이기 때문에 손상 될 경우를 대비하여 모든 Block Group에 사본이 저장되어 있어 Super Block이 문제가 있을 시 다른 Block Group에 있는 Super Block의 복사본을 이용할 수 있다.</p>

<p>슈퍼 블록에 저장되는 주요 데이터는 블록의 크기(1KB, 2KB, 4KB), 총 블록의 개수, 블록 그룹의 개수, Inode의 개수, 그룹 내의 블록/Inode의 개수 이다.</p>

<h4 id="section-1">주요 저장 내용</h4>
<ul>
  <li>파일 시스템에 의존하는 정보인 파일 시스템의 크기</li>
  <li>마운트 정보</li>
  <li>데이터 블록의 총 숫자</li>
  <li>Inode의 총 숫자</li>
  <li>블록 그룹번호</li>
  <li>블록의 크기(1KB, 2KB, 4KB, 8KB)</li>
  <li>그룹 당 블록 수</li>
  <li>슈퍼 블록이 수정되었음을 알리는 정보</li>
</ul>

<blockquote>
  <ul>
    <li>
      <p><strong>매직 넘버</strong>
Magic Number는 마운트하는 소프트웨어에게 ext2 파일 시스템의 슈퍼 블록임을 확인하게 하는 값이다. 현재 ext2 파일 시스템에서 매직 넘버값은 0xEF53이다.</p>
    </li>
    <li>
      <p><strong>개정 레벨</strong>
Revision Level 은 Major level과 Minor Level로 구성되어 있으며, 개정 레벨의 역할은 마운트 프로그램이 어떤 특정한 버전에서만 지원되는 기능이 이파일 시스템에서 지원되는지에 대한 확인을 위해 사용된다. 또한 개정 레벨은 기능 호환성 항목을 포함하여 마운트 프로그램이 해당 파일 시스템에서 안정적으로 사용할 수 있는 기능이 무엇인지를 판단할 수 있는 기준을 제공한다.</p>
    </li>
    <li>
      <p><strong>마운트 횟수와 최대 마운트 횟수</strong>
시스템은 Mount Count 와 Maximum Mount Count 의 2가지 정보를 이용하여 파일 시스템 전체를 검사할 필요가 있는지를 확인할 수 있다. Mount Count는 마운트가 실행될 때 마다 1씩 그 값이 증가하며 만약 Mount Count 가 Maximum Mount Count에 도달하게 되면 시스템은 e2fsck를 실행하라는 메시지를 내보낸다.</p>
    </li>
    <li>
      <p><strong>블록 그룹 번호</strong>
Block Group Number는 슈퍼블록 복사본을 가지고 있는 블록 그룹의 번호를 나타낸다.</p>
    </li>
    <li>
      <p><strong>블록 크기</strong>
Block Size는 파일 시스템의 블록 크기를 표시한다. 블록 크기는 byte단위로 표시된다.</p>
    </li>
    <li>
      <p><strong>그룹 당 블록 수</strong>
Blocks Per Group 은 하나의 그룹에 속한 블록의 수를 나타낸다. 이 수는 블록의 크기와 마찬가지로 파일 시스템을 만들 때 결정된다.</p>
    </li>
    <li>
      <p><strong>프리 블록</strong>
파일 시스템 내부적으로 존재하는 Free Block의 수를 나타낸다.</p>
    </li>
    <li>
      <p><strong>프리 아이노드</strong>
파일 시스템 내부적으로 존재하는 Free Inode의 수를 나타낸다.</p>
    </li>
    <li>
      <p><strong>첫 번째 아이노드버</strong>
파일 시스템 내부적으로 존재하는 First Inode의 번호를 나타낸다. 리눅스 시스템에서 ext2 파일 시스템의 첫 번째 아이노드는 ‘/’디렉토리에 대한 디렉토리 엔트리를 나타낸다.</p>
    </li>
  </ul>
</blockquote>

<hr />

<h3 id="group-descriptor-table">그룹 디스크립터 테이블 (Group Descriptor Table)</h3>

<p>블록 그룹 안에서 슈퍼 블록 다음에 위치한다. Group Descriptor라고 불리는 파일 시스템의 블록 그룹들에 대한 정보를 가지고 있다. 그룹 디스크립터 테이블에 저장되는 주요 데이터는 Block Bitmap의 블록 번호, Inode Bitmap의 블록 번호, 첫 번째 Inode Table Block의 블록 번호, 그룹 안에 있는 빈 블록 수, 그룹 안에 있는 Inode 수, 그룹 안에 있는 빈 디렉토리 수 등이다.</p>

<p>Group Descriptor의 크기는 32Byte로, 블록 크기가 1KB라면 하나의 블록에 총 32개의 Group Descriptor가 기록될 수 있다.</p>

<p>서로 연결되어 있어서 전체적으로는 하나의 Group Descriptor Table을 형성하며 파일 시스템이 Mount될 때, 커널은 Group 0 에 들어있는 Group Descriptor Table을 읽는다. 주요 Data이기 때문에 손상 될 경우를 대비하여 모든 Block Group에 사본이 저장되어 있어 Group Descriptor Table이 문제가 있을 시 다른 Block Group에 있는 Group Descriptor Table의 복사본을 이용할 수 있다.</p>

<h4 id="section-2">주요 저장 내용</h4>

<ul>
  <li>Block Bitmap의 블록 번호</li>
  <li>Inode Bitmap의 블록 번호</li>
  <li>첫 번째 Inode Table Block의 블록 번호</li>
  <li>그룹 안에 있는 빈 블록 수</li>
  <li>그룹 안에 있는 Inode수</li>
  <li>그룹 안에 있는 빈 디렉토리 수</li>
</ul>

<hr />

<h3 id="block-bitmap">블록 비트맵 (Block Bitmap)</h3>

<p>블록 그룹에서 그룹 디스크립터 테이블 다음으로 위치하지만, 정확한 위치는 정해져있지 않다.<sup id="fnref:8"><a href="#fn:8" class="footnote">8</a></sup> 그룹 디스크립터 테이블의 크기가 일정하지 않기 때문이다. 블록 비트맵(Block Bitmap)은 블록의 사용현황을 bit 표현으로 나타낸다. 각 비트에 해당하는 블록이 사용 중이면 1, 사용 중이지 않으면 0으로 나타낸다.</p>

<hr />

<h3 id="inode-bitmap">아이노드 비트맵 (Inode Bitmap)</h3>

<p>Block Bitmap처럼 bit 표현을 이용하여 Block Group이 관리하는 모든 Inode의 사용 현황을 나타낸다.</p>

<hr />

<h3 id="inode-table">아이노드 테이블 (Inode Table)</h3>

<p>인접하는 연속된 블록으로 이루어져 있으며, 각 블록은 미리 정의된 Inode 개수를 포함한다. Inode의 첫 번째 블록의 번호를 Group Descriptor Table에 저장한다. 모든 Inode의 크기는 128Byte로 동일하다. 1024byte의 Inode Table Block은 Inode 8개를 가질 수 있으며, 4096byte의 Inode Table Block은 32개의 Inode를 가진다.<sup id="fnref:9"><a href="#fn:9" class="footnote">9</a></sup></p>

<hr />

<h3 id="inode">아이노드 (Inode)</h3>

<p>Inode는 파일이나 디렉토리의 모든 정보를 가지고 있는 자료구조를 말하며, 파일 객체가 저장되는 곳이다. Inode의 크기는 슈퍼 블록에서 정의된 크기로 고정된다. 모든 파일들과 디렉토리들은 각각 1개의 Inode를 가지고 있으며, 모든 Inode들은 고유한 주소를 가지고 있다. Inode의 주소를 알고 있다면 해당 Inode가 속한 블록 그룹이 어디인지 계산하여 알아낼 수 있다.</p>

<p>시스템 측면에서는 Inode 번호로 파일을 처리하는데 이는 파일 이름이 Inode 번호와 함께 디렉토리 안에 저장되어 있기 때문이다. 그리고 Inode는 파일의 이름을 제외한 해당 파일의 모든 정보를 가지고 있으며, Inode Table에서 해당 파일이나 디렉터리의 Inode 번호를 찾게 되면 모든 정보를 알 수 있다.</p>

<p>File System을 처음에 생성(초기화)하면 지정된 개수만큼 Inode들이 생성 되며, 생성된 Inode들의 개수는 그 파일 시스템이 갖고 있을 수 있는 최대 File의 수이다.<sup id="fnref:10"><a href="#fn:10" class="footnote">10</a></sup> 이 값은 파일 시스템을 다시 초기화하지<sup id="fnref:11"><a href="#fn:11" class="footnote">11</a></sup> 않는 이상 변경할 수 없다.</p>

<p>Inode 1번은 Super Block, 2번은 루트 디렉토리이며, 10번까지는 예약되어 있기 때문에 사용할 수 없다.</p>

<p><img src="/assets/media/linux-starter-guide/ext2-inode.gif" alt="screenshot" /></p>

<blockquote>
  <p><strong>Ext2에 대한 커널 문서의 인용문에 따르면 다음과 같다.</strong></p>

  <p>“아이노드에서 파일의 데이터를 포함하는 첫 12블록의 포인터가 있다. (블록의 다음 세트에 포인터를 포함하는) 간접 블록에 대한 포인터, (간접 블록에 대한 포인터를 포함하는) 이중 간접 블록에 대한 포인터, 그리고 (이중 간접 블록에 대한 포인터를 포함하는) 삼중-간접 블록에 대한 포인터가 있다.”</p>
</blockquote>

<p>Ext2 내부는 15개의 포인터가 있는 구조며 그 중 처음부터 12번까지는 직접 블록을 위한 것이다. 13번 포인터는 간접 블록을, 14번째 블록은 이중 간접 블록을, 그리고 15번째 포인터는 삼중 간접 블록을 가리킨다.</p>

<p>만약 각 데이터 Block의 크기가 8KB이라면, 최대 파일 크기는 약 64TB이다. Direct Block Pointer = 8KB * 12개 = 96KB Indirect Block Pointer = 8KB * 2048개 = 16,384KB Triple Indirect Pointer = 8KB * 2048개 * 2048개 = 33,554,432KB 그리고 데이터 Block의 크기가 4KB인 경우 최대 파일 크기는 약 4TB이다.</p>

<p><img src="/assets/media/linux-starter-guide/20131117_215621.png" alt="screenshot" /></p>

<h4 id="section-3">주요 저장 내용</h4>

<ul>
  <li>Inode Number</li>
  <li>파일 모드 : 파일과 관계된 접근과 실행 권한을 저장하는 16비트 플래그</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: center">비트</th>
      <th style="text-align: center">내용</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">12-14</td>
      <td style="text-align: center">파일 형식 (일반, 디렉터리, 문자 또는 특별, 선입선출 파이프)</td>
    </tr>
    <tr>
      <td style="text-align: center">9-11</td>
      <td style="text-align: center">실행 플래그 (setuid, setgid, sticky bit)</td>
    </tr>
    <tr>
      <td style="text-align: center">8</td>
      <td style="text-align: center">소유자 읽기 허가</td>
    </tr>
    <tr>
      <td style="text-align: center">7</td>
      <td style="text-align: center">소유자 쓰기 허가</td>
    </tr>
    <tr>
      <td style="text-align: center">6</td>
      <td style="text-align: center">소유자 실행 허가</td>
    </tr>
    <tr>
      <td style="text-align: center">5</td>
      <td style="text-align: center">그룹 읽기 허가</td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td style="text-align: center">그룹 쓰기 허가</td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">그룹 실행 허가</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">다른 사용자 읽기 허가</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">다른 사용자 쓰기 허가</td>
    </tr>
    <tr>
      <td style="text-align: center">0</td>
      <td style="text-align: center">다른 사용자 실행 허가</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>하드 링크 수 : 이 아이노드에 대한 디렉터리 참조 수</li>
  <li>소유자 ID : 파일의 개별 소유자</li>
  <li>파일 크기 : 파일의 바이트 수</li>
  <li>마지막 접근 : 마지막으로 파일에 접근한 시각</li>
  <li>마지막 수정 : 마지막으로 파일을 수정한 시각</li>
  <li>Inode 수정 : 마지막으로 Inode를 수정한 시각</li>
  <li>데이터 Block 수 : 파일의 실제 데이터가 저장된 위치(Block 주소(번호))를 가리키는 15개의 포인터 배열</li>
</ul>

<blockquote>
  <p><strong>디렉토리 블록에서 아이노드 넘버를 통해 데이터를 찾아가는 절차</strong></p>

  <p><img src="/assets/media/linux-starter-guide/test.png" alt="screenshot" /></p>

  <ul>
    <li>디렉터리 블록에서 찾아갈 파일을 찾는다.<sup id="fnref:12"><a href="#fn:12" class="footnote">12</a></sup></li>
    <li>선택된 파일의 Inode 번호를 해당 디스크의 Inode Table에서 찾는다.
.* 해당 번호의 Inode정보에 들어있는 디스크상의 데이터 주소를 참조한다.</li>
  </ul>
</blockquote>

<hr />

<h3 id="data-block-">데이터 블록 ( Data Block )</h3>

<p>파일에서 데이터를 저장하는 블록으로 일반 파일이나 디렉터리의 파일의 데이터가 존재한다. Inode에 포함 되어 있으며, Inode는 몇 개의 데이터 블록을 포함한다.</p>

<hr />

<h3 id="directory-block-">디렉토리 블록 ( Directory Block )</h3>

<p>ext2 파일 시스템에서 디렉토리는 파일 시스템 상에서 파일에 대한 접근 경로를 생성하고 저장하는 특별한 의미의 파일로 취급한다. 각각의 디렉토리는 디렉토리 엔트리의 리스트로 나타낸다.</p>

<hr />

<h3 id="indirection-block-">간접 블록 ( Indirection Block )</h3>

<p>추가적인 데이터 블록을 위한 포인터들이 사용할 동적으로 할당되는 공간이다. Inode가 가지고 있는 데이터 블록보다 더 많은 데이터 블록이 필요한 경우 이를 지정하기 위해 포인터를 사용하는데, 그때 사용하기 위한 동적인 블록이다.</p>

<hr />

<h3 id="hole-">홀 ( Hole )</h3>

<p>Inode나 간접 블록 안의 데이터 블록의 주소로 특별한 값을 저장한다. 파일 시스템에 의해서 파일 안에 자리하게 되며, 실질적으로 디스크 상에 공간은 할당 되지 않는다. 단지 0byte가 파일 안에서 특정 공간을 차지하고 있다고 가정하는 것이다.</p>

<h2 id="ext3-extended-file-system">03 ext3의 특징(extended file system)</h2>

<p>기존의 ext2는 Cache에 저장되어 있는 데이터들을 디스크로 저장하는 도중 만약 시스템이 다운되거나 여러 가지 문제가 발생할 경우 파일 시스템이 손상되는 단점을 가지고 있었다. 이를 위해 ext2는 fsck(file system check)라는 파일 시스템 복구 기능을 제공한다. 하지만 이 복구 방법은 복구하는데 시간이 많이 소요된다. 또한 fsck 동안에는 시스템을 사용할 수 없다. ext3 파일시스템은 이러한 단점을 보완하기 위하여 저널링이라는 기능을 추가해서 소개된 파일 시스템이다. 따라서 기본적인 ext2와 동일하고 ext2 파일 시스템과 호환된다. 특히 ext3 파일 시스템에서 주목할 만한 것은 바로 Journaling 이라는 기술이다.</p>

<h3 id="ext3----">ext3 파일 시스템으로의 포팅 동기</h3>

<p>ext2 기능적인 측면보다는 파일 시스템의 효율과 퍼포먼스에 중점을 두고 디자인된 파일 시스템이다. 그래서 ext2는 파일의 내용과 파일에 대한 허가권, 소유권, 생성과 접근시간과 같은 메타 데이터를 동기화하지 않는다. 이럴 경우 만약 파일의 내용을 수정하는 도중에 시스템에 문제가 생길 경우 해당 파일의 메타 데이터와 내용이 일치하지 않는 문제점이 발생하게 된다. 따라서 이러한 문제점을 보완하기 위해서 저널링 기술을 이용한 ext3 파일 시스템이 대두된 것이다.</p>

<h3 id="section-4">저널링 기술</h3>

<p>Journaling 기술은 기존의 fsck에 걸리는 시간을 단축하기 위해 데이터를 디스크에 쓰기 전에 Log에 데이터를 남겨 시스템의 비정상적인 셧다운에도 로그를 사용해 fsck보다 빠르고 안정적인 복구 기능을 제공하는 기술이다.</p>

<p>기존의 ext2 파일 시스템의 경우에는 시스템이 동작을 멈추기 바로 직전에 파일 시스템에 어떠한 수정을 가하고 있었는지 전혀 알 수 없었다. 그렇기 때문에 이를 복구하기 위해서는 fsck에 의해서 관리되는 슈퍼블록, 비트맵, 아이노드 등을 모두 검사해야 하기 때문에 시간이 오래 걸렸다.</p>

<p>하지만 저널링 기술을 사용한 파일 시스템의 경우에는 파일을 실제로 수정하기 전에 우선 로그에 수정된 내용을 저장한다. 그래서 시스템이 비정상적으로 동작을 멈추더라도 시스템의 파일 시스템을 복구하기 위해서 로그만을 검사하면 된다. 이러한 특징 때문에 저널링 파일 시스템을 Log-Ging 파일 시스템이라고 부르기도 한다.</p>

<h2 id="extended-file-system-1">04 파일 및 디렉토리 구조(extended file system)</h2>

<p><img src="/assets/media/linux-starter-guide/파일구조.jpg" alt="screenshot" /></p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">d</th>
      <th style="text-align: center">rwxr-xr-x</th>
      <th style="text-align: center">2</th>
      <th style="text-align: center">root</th>
      <th style="text-align: center">root</th>
      <th style="text-align: center">4096</th>
      <th style="text-align: center">12월 30일</th>
      <th style="text-align: center">00:32</th>
      <th style="text-align: center">.gotreamer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">①</td>
      <td style="text-align: center">②</td>
      <td style="text-align: center">③</td>
      <td style="text-align: center">④</td>
      <td style="text-align: center">⑤</td>
      <td style="text-align: center">⑥</td>
      <td style="text-align: center">⑦</td>
      <td style="text-align: center">⑧</td>
      <td style="text-align: center">⑨</td>
    </tr>
  </tbody>
</table>

<p>① 파일유형 : 일반 파일(-), 디렉터리(d), 블록 디바이스(b), 문자 디바이스(c), 링크(l)</p>

<p>② 파일허가권</p>

<p>③ 링크 수</p>

<p>④ 소유자 명</p>

<p>⑤ 그룹 명</p>

<p>⑥ 파일 크기</p>

<p>⑦ 마지막 변경일</p>

<p>⑧ 마지막 변경 시간</p>

<p>⑨ 파일/폴더 명</p>

<h2 id="section-5">05 링크</h2>

<p><img src="/assets/media/linux-starter-guide/inode.jpg" alt="screenshot" /></p>

<h3 id="ln----">하드링크 (#ln [대상 경로] [링크 경로])</h3>

<p>디렉토리에 그 파일에 대한 새로운 이름이 등록되고 Inode number는 본래 있던 파일의 Inode number가 복사되어 동일한 inode를 사용한다. 이때 복사되는 파일의 Inode에서 파일의 링크수가 하나 증가된다.</p>

<p>다른 파티션에서는 링크가 불가능하며 디렉토리는 하드링크를 할 수 없으나 기본 하드링크를 2개 가지고 있다.<sup id="fnref:13"><a href="#fn:13" class="footnote">13</a></sup></p>

<h3 id="ln-s----">심볼릭 링크 (#ln –s [대상 경로] [링크 경로])</h3>

<p>디렉토리에 그 파일에 대한 새로운 이름이 등록되고 새로운 inode를 생성하며 inode원본 파일을 연결한다. 심볼릭 링크의 경우 원본 파일의 주소가 저장되어 있으므로 원본 파일의 위치가 변경되면 심볼릭 링크는 사용할 수 없게 된다.</p>

<p>심볼릭 링크는 하드링크와 달리 다른 파티션에서도 링크가 가능하며 윈도우의 바로가기와 비슷하다.</p>

<hr />

<h2 id="section-6">관련글</h2>

<h3 id="section-7">초보자를 위한 가이드</h3>

<ul>
  <li><a href="/os/2015/05/25/linux-starter-guide-0.html">[리눅스 정리 - 초보자를 위한 가이드] 들어가며,</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-1.html">[리눅스 정리 - 초보자를 위한 가이드] 1장. 실습환경 구축</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-2.html">[리눅스 정리 - 초보자를 위한 가이드] 2장. 명령어</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-3.html">[리눅스 정리 - 초보자를 위한 가이드] 3장. 디렉토리</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-4.html">[리눅스 정리 - 초보자를 위한 가이드] 4장. 파일 시스템</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-5.html">[리눅스 정리 - 초보자를 위한 가이드] 5장. 표준 스트림</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-6.html">[리눅스 정리 - 초보자를 위한 가이드] 6장. Vi</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-7.html">[리눅스 정리 - 초보자를 위한 가이드] 7장. 사용자 관리</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-8.html">[리눅스 정리 - 초보자를 위한 가이드] 8장. 쉘 스크립트</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-9.html">[리눅스 정리 - 초보자를 위한 가이드] 9장. 프로세스</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-10.html">[리눅스 정리 - 초보자를 위한 가이드] 10장. 소프트웨어 설치</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-11.html">[리눅스 정리 - 초보자를 위한 가이드] 마치며,</a></li>
  <li><a href="/os/2015/05/25/linux-starter-guide-12.html">[리눅스 정리 - 초보자를 위한 가이드] 추가. 퍼미션</a></li>
</ul>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>출처 : 위키백과 - 파일시스템 <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>출처 :  <a href="http://bestheroz.blog.me/66700589">bestheroz님의 블로그</a> <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>Journaling은 변경을 기록하는 로그(journal)를 두어 시스템 비정상 종료 시 파일 시스템 복구를 쉽게 하는 방법을 말한다. <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:4">
      <p>출처 : <a href="http://ite-station.com/zbxe/lecture_server">ITe-station</a> <a href="#fnref:4" class="reversefootnote">&#8617;</a> <a href="#fnref:4:1" class="reversefootnote">&#8617;<sup>2</sup></a></p>
    </li>
    <li id="fn:5">
      <p>프로세스(병행으로 주행하는 태스크)에 대한 기억 영역의 할당과 프로세스에 의한 기억 영역의 해방을 반복함으로써 작은 기억 영역의 분할부가 다수 생성되는 것. 사용할 수 있는 기억 공간이 프로세스가 요구하는 크기보다 작기 때문에 어떤 요구도 만족할 수 없고, 사용하지 않은 상태로 남아 있는 상태를 말한다. - 컴퓨터인터넷IT용어대사전, 2011.1.20, 일진사 <a href="#fnref:5" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:6">
      <p>데이터가 분산되어 저장되면서 메모리에 구멍이 생기는 것 <a href="#fnref:6" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:7">
      <p>블록의 크기에 관계없이 블록 그룹의 시작부터 1024Byte 안에 슈퍼블록의 정보가 기록되어야 한다. <a href="#fnref:7" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:8">
      <p>Group Descriptor Table에 Block Bitmap의 위치가 포함되어 있는 이유 <a href="#fnref:8" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:9">
      <p>ext4의 경우는 256byte의 크기를 가지며, ext2의 경우가 128byte의 크기를 가짐 <a href="#fnref:9" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:10">
      <p>데이터 블록이 디스크 상의 어느 주소에 위치하고 있는지 정보와 같은 중요 정보를 가지기 때문이다. <a href="#fnref:10" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:11">
      <p>기존 데이터가 모두 파괴 된다. <a href="#fnref:11" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:12">
      <p>디렉토리는 파일의 이름과 Inode Number를 저장하는 Table이다. 사람은 파일을 이름으로 구분하 고, 컴퓨터는 Inode Number로 구분한다. <a href="#fnref:12" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:13">
      <p>디렉토리는 내부에 자신을 가리키는 <code class="highlighter-rouge">.</code>을 포함하기 때문이다. <a href="#fnref:13" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			
				<li><a href="/categories.html#OS-ref">
					OS <span>(15)</span>
					
				</a></li>
			
		  
		</ul>
		

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			
				<li>
					<a href="/tags.html#OS-ref">
					OS <span>(17)</span>
					,
					</a>
				</li>
			
				<li>
					<a href="/tags.html#Linux-ref">
					Linux <span>(14)</span>
					,
					</a>
				</li>
			
				<li>
					<a href="/tags.html#guide-ref">
					guide <span>(14)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=[리눅스 정리 - 초보자를 위한 가이드] 4장. 파일 시스템"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="/assets/media/logo.jpg" class="img-rounded author-image" />
        <h4 class="section-title author-name">Donghyun Seo</h4>
        <p class="author-bio">How do you define yourself?</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/os/2015/05/25/linux-starter-guide-3.html" title="[리눅스 정리 - 초보자를 위한 가이드] 3장. 디렉토리">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/os/2015/05/25/linux-starter-guide-5.html" title="[리눅스 정리 - 초보자를 위한 가이드] 5장. 표준 스트림">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>

	<div class="col-sm-2 sidebar-2">

	</div>

    
        
<div id="disqus_thread" class="col-sm-10"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'egaoneko';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


    
</article>
<div class="clearfix"></div>



		<footer>
			<hr/>
			<p>
				Copyright &copy; 2016 Donghyun Seo All rights reserved. / Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek. <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/kr/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/2.0/kr/88x31.png" /></a><br />이 블로그의 모든 저작물들은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/kr/">크리에이티브 커먼즈 저작자표시-비영리-동일조건변경허락 2.0 대한민국 라이선스</a>에 따라 이용할 수 있습니다.</a>
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-62717870-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

